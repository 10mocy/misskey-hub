import{_ as t,o as l,c as o,a as e,b as a,d as n,e as i,r as c}from"./app.5c316688.js";const r={},d=e("h1",{id:"guida-alla-costruzione-di-misskey",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#guida-alla-costruzione-di-misskey","aria-hidden":"true"},"#"),n(" Guida alla costruzione di Misskey")],-1),u=e("p",null,"Questa guida spiega come installare e configurare Misskey",-1),p={class:"custom-container tip"},v=e("i",{class:"fas fa-info"},null,-1),m=e("p",null,"Occorre installare il seguente software",-1),b={href:"https://nodejs.org/en/",target:"_blank",rel:"noopener noreferrer"},h=n("Node.js"),k=n(" (16.x o successivo)"),g={href:"https://www.postgresql.org/",target:"_blank",rel:"noopener noreferrer"},f=n("PostgreSQL"),y=n(" (10 o successivo)"),_={href:"https://redis.io/",target:"_blank",rel:"noopener noreferrer"},z=n("Redis"),x={href:"https://yarnpkg.com/",target:"_blank",rel:"noopener noreferrer"},S=n("Yarn"),E=n(" (serie v1)"),w={href:"https://www.ffmpeg.org/",target:"_blank",rel:"noopener noreferrer"},N=n("FFmpeg"),M=i(`<p>Variabili d&#39;ambiente</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">NODE_ENV</span><span class="token operator">=</span>production
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>:::</p><h2 id="creazione-utente" tabindex="-1"><a class="header-anchor" href="#creazione-utente" aria-hidden="true">#</a> Creazione utente</h2><p>Misskey non va eseguito tramite l&#39;utente amministratore <em>root</em>. Occorre creare un utente ad-hoc, esempio per Debian/Ubuntu:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>adduser --disabled-password --disabled-login misskey
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="installazione-misskey" tabindex="-1"><a class="header-anchor" href="#installazione-misskey" aria-hidden="true">#</a> Installazione Misskey</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">su</span> - misskey
<span class="token function">git</span> clone --recursive -b master https://github.com/misskey-dev/misskey.git
<span class="token function">git</span> submodule update --init
<span class="token builtin class-name">cd</span> misskey
<span class="token function">git</span> checkout master
<span class="token function">yarn</span> <span class="token function">install</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="variabili-d-ambiente" tabindex="-1"><a class="header-anchor" href="#variabili-d-ambiente" aria-hidden="true">#</a> Variabili d&#39;ambiente</h2><p>Copia il file <code>.config/example.yml</code> in un file chiamato <code>default.yml</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">cp</span> .config/example.yml .config/default.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Modifica <code>default.yml</code> seguendo le indicazioni nel file.</p><h2 id="costruzione-e-inizializzazione" tabindex="-1"><a class="header-anchor" href="#costruzione-e-inizializzazione" aria-hidden="true">#</a> Costruzione e inizializzazione</h2><p>Avvia la build e inizializza il DB, potrebbe richiedere un po&#39; di tempo.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">yarn</span> build
<span class="token function">yarn</span> run init
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><i class="fas fa-info"></i><p>Chi usa Debian/Ubuntu ha bisogno del pacchetto <code>build-essential</code></p></div><div class="custom-container tip"><i class="fas fa-info"></i><p>Se ricevi un messaggio di errore per qualche modulo, usa <code>node-gyp</code>:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>npx node-gyp configure
npx node-gyp build
<span class="token function">yarn</span> build
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><h2 id="avviamento" tabindex="-1"><a class="header-anchor" href="#avviamento" aria-hidden="true">#</a> Avviamento</h2><p>Al termine avvia Misskey usando:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">yarn</span> start
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>:::: Configurazione di systemd</p><p>Crea il file <code>/etc/systemd/system/misskey.service</code></p><p>Incollaci questa configurazione:</p><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Unit</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">Description</span><span class="token punctuation">=</span><span class="token value attr-value">Misskey daemon</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Service</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">Type</span><span class="token punctuation">=</span><span class="token value attr-value">simple</span>
<span class="token key attr-name">User</span><span class="token punctuation">=</span><span class="token value attr-value">misskey</span>
<span class="token key attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/bin/npm start</span>
<span class="token key attr-name">WorkingDirectory</span><span class="token punctuation">=</span><span class="token value attr-value">/home/misskey/misskey</span>
<span class="token key attr-name">Environment</span><span class="token punctuation">=</span><span class="token value attr-value">&quot;<span class="token inner-value">NODE_ENV=production</span>&quot;</span>
<span class="token key attr-name">TimeoutSec</span><span class="token punctuation">=</span><span class="token value attr-value">60</span>
<span class="token key attr-name">StandardOutput</span><span class="token punctuation">=</span><span class="token value attr-value">journal</span>
<span class="token key attr-name">StandardError</span><span class="token punctuation">=</span><span class="token value attr-value">journal</span>
<span class="token key attr-name">SyslogIdentifier</span><span class="token punctuation">=</span><span class="token value attr-value">misskey</span>
<span class="token key attr-name">Restart</span><span class="token punctuation">=</span><span class="token value attr-value">always</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Install</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">WantedBy</span><span class="token punctuation">=</span><span class="token value attr-value">multi-user.target</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container warning"><i class="fas fa-exclamation"></i><p>Se usi Misskey su CentOS e una porta inferiore a 1024, Devi configurare <code>ExecStart=/usr/bin/sudo /usr/bin/npm start</code></p></div><p>Ricarica systemd, abilita e avvia il servizio</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>systemctl daemon-reload<span class="token punctuation">;</span>
systemctl <span class="token builtin class-name">enable</span> misskey
systemctl start misskey
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><i class="fas fa-info"></i><p>Per controllare lo stato del servizio: <code>systemctl status misskey</code></p></div><p>::::</p><h2 id="aggiornamento-di-misskey" tabindex="-1"><a class="header-anchor" href="#aggiornamento-di-misskey" aria-hidden="true">#</a> Aggiornamento di Misskey</h2>`,30),C={class:"custom-container warning"},D=e("i",{class:"fas fa-exclamation"},null,-1),O=n("Leggi sempre le "),V={href:"https://github.com/misskey-dev/misskey/blob/master/CHANGELOG.md",target:"_blank",rel:"noopener noreferrer"},A=n("Note di rilascio"),I=n(" per sapere se ci siano attivit\xE0 aggiuntive da svolgere."),q=i(`<p>Ottieni il codice sorgente dal branch <code>master</code> e le migrazioni del database:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">git</span> checkout master
<span class="token function">git</span> pull
<span class="token function">git</span> submodule update --init
<span class="token function">yarn</span> <span class="token function">install</span>
<span class="token function">yarn</span> build
<span class="token function">yarn</span> migrate
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>A seconda della grandezza del database e dal contenuto degli aggiornamenti, potrebbe impiegarci pi\xF9 o meno tempo.</p><p>Riavvia il servizio Misskey al termine dell&#39;aggiornamento.</p><div class="custom-container tip"><i class="fas fa-info"></i><p>Se ricevi errori in fase di compilazione, prova i seguenti comandi:</p><ul><li><code>yarn clean</code> oppure <code>yarn cleanall</code></li><li><code>npm rebuild</code></li></ul></div>`,5);function B(L,j){const s=c("ExternalLinkIcon");return l(),o("div",null,[d,u,e("div",p,[v,m,e("ul",null,[e("li",null,[e("strong",null,[e("a",b,[h,a(s)])]),k]),e("li",null,[e("strong",null,[e("a",g,[f,a(s)])]),y]),e("li",null,[e("strong",null,[e("a",_,[z,a(s)])])]),e("li",null,[e("strong",null,[e("a",x,[S,a(s)])]),E]),e("li",null,[e("strong",null,[e("a",w,[N,a(s)])])])])]),M,e("div",C,[D,e("p",null,[O,e("a",V,[A,a(s)]),I])]),q])}var U=t(r,[["render",B],["__file","manual.html.vue"]]);export{U as default};
